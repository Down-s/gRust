name: Server Files s

on:
  push:
    tags: ["v*"]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4
      - run: zip -r server-files.zip gamemode entities rust.txt
      - id: meta
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "tag=manual-build" >> "$GITHUB_OUTPUT"
            echo "pre=true" >> "$GITHUB_OUTPUT"
          else
            echo "tag=${{ github.ref_name }}" >> "$GITHUB_OUTPUT"
            echo "pre=false" >> "$GITHUB_OUTPUT"
          fi

      - uses: softprops/action-gh-release@v2
        with:
          files: server-files.zip
          tag_name: ${{ steps.meta.outputs.tag }}
          name: Release ${{ steps.meta.outputs.tag }}
          prerelease: ${{ steps.meta.outputs.pre }}
          make_latest: ${{ github.event_name != 'workflow_dispatch' }}
